<?php
/**
 * @file
 * Tests for the shareaholic module
 */
class AdminTestCase extends DrupalWebTestCase {

  public static function getInfo(){
    return array(
      'name' => 'admin class functionality',
      'description' => 'Tests functions of the admin class',
      'group' => 'Shareaholic',
    );
  }

  public function setUp() {
    parent::setUp('shareaholic');
  }

  public function testDrawModalPopup() {
    $tos_modal = "<div class='reveal-modal blocking-modal' id='terms_of_service_modal'>";
    $api_key_modal = "<div class='reveal-modal blocking-modal api-key-modal' id='failed_to_create_api_key'>";

    // Need to obtain the output buffer and store in a variable
    // When the ToS flag is false, modal should be in HTML
    ob_start();
    ShareaholicAdmin::draw_modal_popup();
    $output = ob_get_clean();
    $result = (strpos($output, $tos_modal) !== false && strpos($output, $api_key_modal) === false);
    $this->assertTrue($result, 'It should only show ToS modal when the user has not accepted ToS');

    // Set the ToS flag and api_key for next test
    variable_set('shareaholic_has_accepted_tos', true);
    ShareaholicUtilities::update_options(array(
      'api_key' => false
    ));
    ob_start();
    ShareaholicAdmin::draw_modal_popup();
    $output = ob_get_clean();
    $result = (strpos($output, $tos_modal) === false && strpos($output, $api_key_modal) !== false);
    $this->assertTrue($result, 'It should only show failed api_key modal when the user accepted ToS and has no apikey');

    // Set the api key for the next test
    ShareaholicUtilities::update_options(array(
      'api_key' => 'apikey'
    ));
    ob_start();
    ShareaholicAdmin::draw_modal_popup();
    $output = ob_get_clean();
    $result = (strpos($output, $tos_modal) === false && strpos($output, $api_key_modal) === false);
    $this->assertTrue($result, 'It should not show any modals when the user accepted ToS and has apikey');
  }

}