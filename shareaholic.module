<?php

/**
 * Implements hook_theme().
 */
function shareaholic_theme() {

  return [
    'shareaholic_tos_modal' => [
      'variables' => [
        'path' => '',
      ],
      'template' => 'shareaholic-tos-modal',
    ],
  ];

}

/**
 * Implements hook_preprocess_HOOK().
 */
function shareaholic_preprocess_page(&$variables) {

  if (\Drupal::service('router.admin_context')->isAdminRoute()) {

    $path = '/admin/config/shareaholic/settings';
    $render_message = \Drupal\Core\Render\Markup::create(
      '<strong>Action required: </strong> You\'ve installed Shareaholic for Drupal. We\'re ready when you are. <a href="' . $path . '">Get Started Now</a>.',
      [':status' => $path]
    );

    $settings = \Drupal::config('shareaholic.settings');
    $api_key = $settings->get('api_key');

    if (!$api_key) {
      \Drupal::messenger()->addMessage($render_message, 'warning');
    }

  }

}

/**
 * Implements hook_preprocess_html().
 */
function shareaholic_preprocess_html(&$variables) {

  $sitename = [
    '#tag' => 'meta',
    '#attributes' => [
      'name' => 'shareaholic:site_name',
      'content' => 'works!',
    ],
  ];


  $variables['page']['#attached']['html_head'][] = [$sitename, 'x-ua-compatible'];
}
